/** * Reads SSM environment context from a known Amplify environment variable, * fetches values from SSM and places those values in the corresponding environment variables */export const internalAmplifyFunctionResolveSsmParams = async (client) => {    const envPathObject = JSON.parse(process.env.AMPLIFY_SSM_ENV_CONFIG ?? '{}');    const paths = Object.values(envPathObject).map((paths) => paths.path);    if (paths.length === 0) {        return;    }    let actualSsmClient;    if (client) {        actualSsmClient = client;    }    else {        const ssmSdk = await import('@aws-sdk/client-ssm');        actualSsmClient = new ssmSdk.SSM();    }    const chunkArray = (array, chunkSize) => {        const chunks = [];        for (let i = 0; i < array.length; i += chunkSize) {            chunks.push(array.slice(i, i + chunkSize));        }        return chunks;    };    const resolveSecrets = async (paths) => {        const response = (await Promise.all(chunkArray(paths, 10).map(async (chunkedPaths) => await actualSsmClient.getParameters({            Names: chunkedPaths,            WithDecryption: true,        })))).reduce((accumulator, res) => {            accumulator.Parameters?.push(...(res.Parameters ?? []));            accumulator.InvalidParameters?.push(...(res.InvalidParameters ?? []));            return accumulator;        }, {            Parameters: [],            InvalidParameters: [],        });        if (response.Parameters && response.Parameters.length > 0) {            for (const parameter of response.Parameters) {                if (parameter.Name) {                    const envKey = Object.keys(envPathObject).find((key) => envPathObject[key].sharedPath === parameter.Name ||                        envPathObject[key].path === parameter.Name);                    if (envKey) {                        process.env[envKey] = parameter.Value;                    }                }            }        }        return response;    };    const response = await resolveSecrets(paths);    const sharedPaths = (response?.InvalidParameters || [])        .map((invalidParam) => Object.values(envPathObject).find((paths) => paths.path === invalidParam)?.sharedPath)        .filter((sharedParam) => !!sharedParam);     if (sharedPaths.length > 0) {        await resolveSecrets(sharedPaths);    }};await internalAmplifyFunctionResolveSsmParams();const SSM_PARAMETER_REFRESH_MS = 1000 * 60;setInterval(async () => {    try {        await internalAmplifyFunctionResolveSsmParams();    }    catch (error) {        try {                        console.debug(error);                    }        catch {                    }    }}, SSM_PARAMETER_REFRESH_MS);export {};
import{createRequire as o}from"node:module";import d from"node:path";import n from"node:url";global.require=o(import.meta.url);global.__filename=n.fileURLToPath(import.meta.url);global.__dirname=d.dirname(__filename);var p=async r=>{let{billingRecord:e}=r.arguments,i=[],s=[];if(e.date||i.push({field:"date",message:"Date is required"}),(!e.procedures||e.procedures.length===0)&&i.push({field:"procedures",message:"At least one procedure (CUPS code) is required"}),e.diagnosis||i.push({field:"diagnosis",message:"Diagnosis (ICD-10 code) is required"}),e.eps||i.push({field:"eps",message:"EPS (health insurance provider) is required"}),e.date)if(!/^\d{4}-\d{2}-\d{2}$/.test(e.date))i.push({field:"date",message:"Date must be in ISO 8601 format (YYYY-MM-DD)"});else{let a=new Date(e.date);isNaN(a.getTime())&&i.push({field:"date",message:"Invalid date value"}),a>new Date&&s.push("Date is in the future")}if(e.procedures&&e.procedures.length>0&&e.procedures.forEach((t,a)=>{/^\d{6}$/.test(t)||i.push({field:`procedures[${a}]`,message:`Invalid CUPS code format: ${t}. Expected 6 digits.`})}),e.diagnosis&&(/^[A-Z]\d{2}(\.\d{1,2})?$/.test(e.diagnosis)||i.push({field:"diagnosis",message:`Invalid ICD-10 code format: ${e.diagnosis}`})),e.eps){let t=["EPS001","EPS002","EPS003","SURA","SANITAS","COMPENSAR","FAMISANAR","SALUD_TOTAL"];e.eps.length<3&&i.push({field:"eps",message:"EPS code is too short"}),t.includes(e.eps)||s.push(`EPS '${e.eps}' is not in the common provider list`)}return e.totalAmount!==void 0&&(e.totalAmount<0&&i.push({field:"totalAmount",message:"Amount cannot be negative"}),e.totalAmount===0&&s.push("Amount is zero")),e.patientId||s.push("Patient ID is missing (recommended for tracking)"),e.shiftId||s.push("Shift ID is missing (recommended for audit trail)"),{isValid:i.length===0,errors:i,warnings:s}};export{p as handler};
//# sourceMappingURL=index.mjs.map
