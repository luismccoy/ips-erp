{
  "version": 3,
  "sources": ["../../../../node_modules/@aws-amplify/backend-function/src/lambda-shims/cjs_shim.ts", "../../../../amplify/functions/rips-validator/handler.ts"],
  "sourcesContent": ["import { createRequire } from 'node:module';\nimport path from 'node:path';\nimport url from 'node:url';\nglobal.require = createRequire(import.meta.url);\nglobal.__filename = url.fileURLToPath(import.meta.url);\nglobal.__dirname = path.dirname(__filename);\n", "import { type Schema } from '../../data/resource';\n\n/**\n * RIPS Validator - Colombian Health Ministry Compliance\n * Validates billing records against Resoluci\u00F3n 2275 requirements\n * \n * Validation Rules:\n * 1. Required fields: date, procedures (CUPS codes), diagnosis (ICD-10), EPS\n * 2. Date format: ISO 8601 (YYYY-MM-DD)\n * 3. Procedures: Array of valid CUPS codes (Colombian procedure codes)\n * 4. Diagnosis: Valid ICD-10 code format\n * 5. EPS: Valid Colombian health insurance provider\n */\n\ninterface ValidationError {\n    field: string;\n    message: string;\n}\n\ninterface ValidationResult {\n    isValid: boolean;\n    errors: ValidationError[];\n    warnings: string[];\n}\n\nexport const handler: Schema[\"validateRIPS\"][\"functionHandler\"] = async (event) => {\n    const { billingRecord } = event.arguments;\n    \n    const errors: ValidationError[] = [];\n    const warnings: string[] = [];\n\n    // 1. Validate required fields\n    if (!billingRecord.date) {\n        errors.push({ field: 'date', message: 'Date is required' });\n    }\n    \n    if (!billingRecord.procedures || billingRecord.procedures.length === 0) {\n        errors.push({ field: 'procedures', message: 'At least one procedure (CUPS code) is required' });\n    }\n    \n    if (!billingRecord.diagnosis) {\n        errors.push({ field: 'diagnosis', message: 'Diagnosis (ICD-10 code) is required' });\n    }\n    \n    if (!billingRecord.eps) {\n        errors.push({ field: 'eps', message: 'EPS (health insurance provider) is required' });\n    }\n\n    // 2. Validate date format (ISO 8601)\n    if (billingRecord.date) {\n        const dateRegex = /^\\d{4}-\\d{2}-\\d{2}$/;\n        if (!dateRegex.test(billingRecord.date)) {\n            errors.push({ \n                field: 'date', \n                message: 'Date must be in ISO 8601 format (YYYY-MM-DD)' \n            });\n        } else {\n            // Check if date is valid\n            const date = new Date(billingRecord.date);\n            if (isNaN(date.getTime())) {\n                errors.push({ field: 'date', message: 'Invalid date value' });\n            }\n            \n            // Warn if date is in the future\n            if (date > new Date()) {\n                warnings.push('Date is in the future');\n            }\n        }\n    }\n\n    // 3. Validate CUPS codes (Colombian procedure codes)\n    if (billingRecord.procedures && billingRecord.procedures.length > 0) {\n        billingRecord.procedures.forEach((code: string, index: number) => {\n            // CUPS codes are typically 6 digits\n            const cupsRegex = /^\\d{6}$/;\n            if (!cupsRegex.test(code)) {\n                errors.push({ \n                    field: `procedures[${index}]`, \n                    message: `Invalid CUPS code format: ${code}. Expected 6 digits.` \n                });\n            }\n        });\n    }\n\n    // 4. Validate ICD-10 diagnosis code\n    if (billingRecord.diagnosis) {\n        // ICD-10 codes: Letter + 2 digits + optional decimal + 1-2 digits\n        // Examples: A00, A00.0, A00.01\n        const icd10Regex = /^[A-Z]\\d{2}(\\.\\d{1,2})?$/;\n        if (!icd10Regex.test(billingRecord.diagnosis)) {\n            errors.push({ \n                field: 'diagnosis', \n                message: `Invalid ICD-10 code format: ${billingRecord.diagnosis}` \n            });\n        }\n    }\n\n    // 5. Validate EPS (Colombian health insurance providers)\n    if (billingRecord.eps) {\n        // Common Colombian EPS codes (simplified validation)\n        const validEPS = [\n            'EPS001', 'EPS002', 'EPS003', // Placeholder codes\n            'SURA', 'SANITAS', 'COMPENSAR', 'FAMISANAR', 'SALUD_TOTAL'\n        ];\n        \n        // For now, just check it's not empty and has reasonable length\n        if (billingRecord.eps.length < 3) {\n            errors.push({ \n                field: 'eps', \n                message: 'EPS code is too short' \n            });\n        }\n        \n        // Warn if EPS is not in common list (but don't fail)\n        if (!validEPS.includes(billingRecord.eps)) {\n            warnings.push(`EPS '${billingRecord.eps}' is not in the common provider list`);\n        }\n    }\n\n    // 6. Validate amount\n    if (billingRecord.totalAmount !== undefined) {\n        if (billingRecord.totalAmount < 0) {\n            errors.push({ \n                field: 'totalAmount', \n                message: 'Amount cannot be negative' \n            });\n        }\n        \n        if (billingRecord.totalAmount === 0) {\n            warnings.push('Amount is zero');\n        }\n    }\n\n    // 7. Check for missing optional but recommended fields\n    if (!billingRecord.patientId) {\n        warnings.push('Patient ID is missing (recommended for tracking)');\n    }\n    \n    if (!billingRecord.shiftId) {\n        warnings.push('Shift ID is missing (recommended for audit trail)');\n    }\n\n    const result: ValidationResult = {\n        isValid: errors.length === 0,\n        errors,\n        warnings\n    };\n\n    return result;\n};\n"],
  "mappings": ";AAAA,OAAS,iBAAAA,MAAqB,cAC9B,OAAOC,MAAU,YACjB,OAAOC,MAAS,WAChB,OAAO,QAAUF,EAAc,YAAY,GAAG,EAC9C,OAAO,WAAaE,EAAI,cAAc,YAAY,GAAG,EACrD,OAAO,UAAYD,EAAK,QAAQ,UAAU,ECoBnC,IAAME,EAAqD,MAAOC,GAAU,CAC/E,GAAM,CAAE,cAAAC,CAAc,EAAID,EAAM,UAE1BE,EAA4B,CAAC,EAC7BC,EAAqB,CAAC,EAoB5B,GAjBKF,EAAc,MACfC,EAAO,KAAK,CAAE,MAAO,OAAQ,QAAS,kBAAmB,CAAC,GAG1D,CAACD,EAAc,YAAcA,EAAc,WAAW,SAAW,IACjEC,EAAO,KAAK,CAAE,MAAO,aAAc,QAAS,gDAAiD,CAAC,EAG7FD,EAAc,WACfC,EAAO,KAAK,CAAE,MAAO,YAAa,QAAS,qCAAsC,CAAC,EAGjFD,EAAc,KACfC,EAAO,KAAK,CAAE,MAAO,MAAO,QAAS,6CAA8C,CAAC,EAIpFD,EAAc,KAEd,GAAI,CADc,sBACH,KAAKA,EAAc,IAAI,EAClCC,EAAO,KAAK,CACR,MAAO,OACP,QAAS,8CACb,CAAC,MACE,CAEH,IAAME,EAAO,IAAI,KAAKH,EAAc,IAAI,EACpC,MAAMG,EAAK,QAAQ,CAAC,GACpBF,EAAO,KAAK,CAAE,MAAO,OAAQ,QAAS,oBAAqB,CAAC,EAI5DE,EAAO,IAAI,MACXD,EAAS,KAAK,uBAAuB,CAE7C,CA+BJ,GA3BIF,EAAc,YAAcA,EAAc,WAAW,OAAS,GAC9DA,EAAc,WAAW,QAAQ,CAACI,EAAcC,IAAkB,CAE5C,UACH,KAAKD,CAAI,GACpBH,EAAO,KAAK,CACR,MAAO,cAAcI,CAAK,IAC1B,QAAS,6BAA6BD,CAAI,sBAC9C,CAAC,CAET,CAAC,EAIDJ,EAAc,YAGK,2BACH,KAAKA,EAAc,SAAS,GACxCC,EAAO,KAAK,CACR,MAAO,YACP,QAAS,+BAA+BD,EAAc,SAAS,EACnE,CAAC,GAKLA,EAAc,IAAK,CAEnB,IAAMM,EAAW,CACb,SAAU,SAAU,SACpB,OAAQ,UAAW,YAAa,YAAa,aACjD,EAGIN,EAAc,IAAI,OAAS,GAC3BC,EAAO,KAAK,CACR,MAAO,MACP,QAAS,uBACb,CAAC,EAIAK,EAAS,SAASN,EAAc,GAAG,GACpCE,EAAS,KAAK,QAAQF,EAAc,GAAG,sCAAsC,CAErF,CAGA,OAAIA,EAAc,cAAgB,SAC1BA,EAAc,YAAc,GAC5BC,EAAO,KAAK,CACR,MAAO,cACP,QAAS,2BACb,CAAC,EAGDD,EAAc,cAAgB,GAC9BE,EAAS,KAAK,gBAAgB,GAKjCF,EAAc,WACfE,EAAS,KAAK,kDAAkD,EAG/DF,EAAc,SACfE,EAAS,KAAK,mDAAmD,EAGpC,CAC7B,QAASD,EAAO,SAAW,EAC3B,OAAAA,EACA,SAAAC,CACJ,CAGJ",
  "names": ["createRequire", "path", "url", "handler", "event", "billingRecord", "errors", "warnings", "date", "code", "index", "validEPS"]
}
