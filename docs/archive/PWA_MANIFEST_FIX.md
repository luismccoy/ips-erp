# PWA Manifest Fix - Amplify Routing Issue

## Problem
The `/manifest.webmanifest` endpoint was returning HTML (index.html) instead of JSON, breaking PWA installation.

## Root Cause
AWS Amplify's SPA fallback routing was catching the manifest request and serving index.html instead of the actual manifest file.

## Solution
Updated `amplify.yml` with explicit routing rules:

### Key Changes

1. **Added explicit manifest rule with Content-Type header:**
   ```yaml
   - source: /manifest.webmanifest
     target: /manifest.webmanifest
     status: '200'
     headers:
       - key: Content-Type
         value: 'application/manifest+json'
   ```

2. **Simplified SPA fallback rule:**
   - Changed from complex regex to simple `/<*>` catch-all
   - This ensures ALL specific rules above are processed first
   - SPA fallback is now clearly the last resort

### Rule Ordering (Critical!)
The order matters in Amplify:
1. Manifest (explicit, with headers)
2. Service Worker files
3. Static assets (icons, SVGs, PNGs)
4. SPA fallback (MUST be last)

## Files Involved
- `amplify.yml` - Updated customRules section
- `public/manifest.webmanifest` - Valid JSON manifest (also auto-generated by VitePWA plugin)
- `vite.config.ts` - VitePWA plugin configuration (unchanged)

## Testing
After deployment:
```bash
curl -I https://main.d2wwgecog8smmr.amplifyapp.com/manifest.webmanifest
# Should return: Content-Type: application/manifest+json

curl https://main.d2wwgecog8smmr.amplifyapp.com/manifest.webmanifest
# Should return: valid JSON (not HTML)
```

## Notes
- VitePWA plugin generates manifest.webmanifest during build from vite.config.ts
- public/manifest.webmanifest serves as fallback/source
- Both customHeaders and customRules set Content-Type (belt and suspenders)
- Simplified SPA fallback is more maintainable and less error-prone

## Related
- PWA setup: `docs/PWA_SETUP.md`
- Amplify docs: https://docs.aws.amazon.com/amplify/latest/userguide/redirects.html
