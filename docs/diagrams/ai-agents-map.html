<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Agent Interactions - IPS ERP</title>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #0f172a;
      color: #e2e8f0;
      padding: 40px 20px;
      margin: 0;
    }
    .container {
      max-width: 1600px;
      margin: 0 auto;
    }
    h1 {
      color: #818cf8;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 15px;
    }
    h2 {
      color: #a78bfa;
      margin-top: 50px;
      border-bottom: 2px solid #334155;
      padding-bottom: 10px;
    }
    h3 {
      color: #818cf8;
      margin-top: 30px;
    }
    .subtitle {
      color: #94a3b8;
      margin-bottom: 30px;
      font-size: 1.1em;
    }
    .diagram {
      background: #1e293b;
      padding: 30px;
      border-radius: 12px;
      margin: 20px 0;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      overflow-x: auto;
    }
    .info-box {
      background: #334155;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
      border-left: 4px solid #818cf8;
    }
    .info-box h3 {
      margin-top: 0;
      color: #818cf8;
    }
    .agent-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 25px;
      margin: 25px 0;
    }
    .agent-card {
      background: linear-gradient(145deg, #1e293b 0%, #0f172a 100%);
      padding: 25px;
      border-radius: 12px;
      border: 1px solid #334155;
      position: relative;
      overflow: hidden;
    }
    .agent-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
    }
    .agent-card.roster::before { background: linear-gradient(90deg, #34d399, #10b981); }
    .agent-card.glosa::before { background: linear-gradient(90deg, #f472b6, #ec4899); }
    .agent-card.rips::before { background: linear-gradient(90deg, #60a5fa, #3b82f6); }
    
    .agent-card h4 {
      color: #f8fafc;
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 1.3em;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .agent-card .model {
      background: #0f172a;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.75em;
      color: #f59e0b;
      font-weight: 500;
      border: 1px solid #f59e0b33;
    }
    .agent-card .description {
      color: #94a3b8;
      margin-bottom: 15px;
      font-size: 0.95em;
    }
    .stat-row {
      display: flex;
      gap: 15px;
      margin-top: 15px;
    }
    .stat {
      flex: 1;
      background: #0f172a;
      padding: 12px;
      border-radius: 8px;
      text-align: center;
    }
    .stat-value {
      font-size: 1.5em;
      font-weight: bold;
      color: #34d399;
    }
    .stat-label {
      font-size: 0.8em;
      color: #94a3b8;
      margin-top: 4px;
    }
    .io-section {
      margin-top: 15px;
    }
    .io-section strong {
      color: #818cf8;
      font-size: 0.9em;
    }
    .io-section ul {
      margin: 8px 0;
      padding-left: 20px;
    }
    .io-section li {
      color: #cbd5e1;
      margin: 4px 0;
      font-size: 0.9em;
    }
    code {
      background: #0f172a;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 13px;
      color: #60a5fa;
    }
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin: 25px 0;
    }
    .metric-card {
      background: #1e293b;
      padding: 25px;
      border-radius: 12px;
      text-align: center;
      border: 1px solid #334155;
    }
    .metric-card .icon {
      font-size: 2.5em;
      margin-bottom: 10px;
    }
    .metric-card .value {
      font-size: 2em;
      font-weight: bold;
      color: #34d399;
    }
    .metric-card .label {
      color: #94a3b8;
      font-size: 0.9em;
      margin-top: 5px;
    }
    .compliance-box {
      background: linear-gradient(145deg, #1e293b 0%, #172033 100%);
      border: 1px solid #334155;
      border-radius: 12px;
      padding: 25px;
      margin: 25px 0;
    }
    .compliance-box h4 {
      color: #f59e0b;
      margin-top: 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .regulation-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    .regulation {
      background: #0f172a;
      padding: 15px;
      border-radius: 8px;
      border-left: 3px solid #f59e0b;
    }
    .regulation strong {
      color: #f8fafc;
      display: block;
      margin-bottom: 5px;
    }
    .regulation p {
      color: #94a3b8;
      font-size: 0.9em;
      margin: 0;
    }
    .cost-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    .cost-table th, .cost-table td {
      padding: 15px;
      text-align: left;
      border-bottom: 1px solid #334155;
    }
    .cost-table th {
      background: #1e293b;
      color: #818cf8;
      font-weight: 600;
    }
    .cost-table td {
      color: #cbd5e1;
    }
    .cost-table tr:hover td {
      background: #1e293b44;
    }
    .cost-positive { color: #34d399 !important; font-weight: bold; }
    .cost-negative { color: #f87171 !important; }
    .integration-flow {
      background: #1e293b;
      padding: 30px;
      border-radius: 12px;
      margin: 20px 0;
    }
    .flow-steps {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    .flow-step {
      flex: 1;
      min-width: 150px;
      background: #0f172a;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      border: 1px solid #334155;
    }
    .flow-step .number {
      background: #818cf8;
      color: #0f172a;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .flow-step .icon {
      font-size: 2em;
      margin: 10px 0;
    }
    .flow-step .label {
      color: #f8fafc;
      font-weight: 500;
    }
    .flow-arrow {
      color: #818cf8;
      font-size: 1.5em;
    }
    @media (max-width: 768px) {
      .metrics-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      .flow-arrow {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ü§ñ AI Agent Interactions</h1>
    <p class="subtitle">Intelligent automation powered by Amazon Bedrock (Claude models) for healthcare excellence</p>

    <!-- Executive Summary -->
    <div class="info-box">
      <h3>üìã Executive Summary</h3>
      <p>IPS-ERP leverages three specialized AI agents to automate critical healthcare operations, ensuring compliance with Colombian regulations while dramatically improving efficiency and revenue recovery.</p>
      <div class="metrics-grid">
        <div class="metric-card">
          <div class="icon">üß†</div>
          <div class="value">3</div>
          <div class="label">AI Agents</div>
        </div>
        <div class="metric-card">
          <div class="icon">üí∞</div>
          <div class="value">$5.1M</div>
          <div class="label">Monthly Recovery</div>
        </div>
        <div class="metric-card">
          <div class="icon">‚è±Ô∏è</div>
          <div class="value">2h 45m</div>
          <div class="label">Daily Time Saved</div>
        </div>
        <div class="metric-card">
          <div class="icon">‚úÖ</div>
          <div class="value">98%</div>
          <div class="label">Validation Accuracy</div>
        </div>
      </div>
    </div>

    <!-- Agent Overview Diagram -->
    <h2>üèóÔ∏è AI Agent Architecture Overview</h2>
    
    <div class="diagram">
      <pre class="mermaid">
graph TB
    subgraph "IPS-ERP Healthcare Platform"
        direction TB
        
        subgraph "Data Sources"
            Patients[(üë• Patient Data)]
            Visits[(üìã Visit Records)]
            Nurses[(üë©‚Äç‚öïÔ∏è Nurse Profiles)]
            EPS[(üè• EPS Claims)]
        end
        
        subgraph "Amazon Bedrock"
            direction LR
            
            subgraph "Roster Architect"
                RA[üóìÔ∏è Roster Architect AI<br/>Claude 3.7 Sonnet]
            end
            
            subgraph "Glosa Defender"
                GD[‚öñÔ∏è Glosa Defender AI<br/>Claude Opus 4.5]
            end
            
            subgraph "RIPS Validator"
                RV[üìù RIPS Validator AI<br/>Claude 3.7 Sonnet]
            end
        end
        
        subgraph "Outputs"
            Assignments[üìÖ Optimal Assignments]
            Justifications[üìÑ Legal Justifications]
            ValidatedRIPS[‚úÖ Validated RIPS XML]
        end
        
        subgraph "Compliance"
            Res3100[üìú Resolution 3100]
            RIPS[üìä RIPS Format]
            MinSalud[üèõÔ∏è MinSalud Standards]
        end
    end
    
    Patients --> RA
    Nurses --> RA
    RA --> Assignments
    
    EPS --> GD
    Visits --> GD
    Res3100 --> GD
    GD --> Justifications
    
    Visits --> RV
    RIPS --> RV
    MinSalud --> RV
    RV --> ValidatedRIPS
    
    style RA fill:#34d399,stroke:#059669,color:#0f172a
    style GD fill:#f472b6,stroke:#be185d,color:#0f172a
    style RV fill:#60a5fa,stroke:#1e40af,color:#0f172a
    style Res3100 fill:#f59e0b,stroke:#d97706,color:#0f172a
    style RIPS fill:#f59e0b,stroke:#d97706,color:#0f172a
    style MinSalud fill:#f59e0b,stroke:#d97706,color:#0f172a
      </pre>
    </div>

    <!-- Three Agent Cards -->
    <h2>üéØ Meet the AI Agents</h2>
    
    <div class="agent-grid">
      <!-- Roster Architect -->
      <div class="agent-card roster">
        <h4>üóìÔ∏è Roster Architect AI <span class="model">Claude 3.7 Sonnet</span></h4>
        <p class="description">Intelligent shift optimization that minimizes travel time while matching nurse skills to patient needs.</p>
        
        <div class="io-section">
          <strong>üì• Inputs:</strong>
          <ul>
            <li>Unassigned shifts queue</li>
            <li>Nurse availability calendar</li>
            <li>Patient GPS coordinates</li>
            <li>Required certifications</li>
            <li>Traffic patterns & distances</li>
          </ul>
        </div>
        
        <div class="io-section">
          <strong>üì§ Outputs:</strong>
          <ul>
            <li>Optimal nurse-to-shift assignments</li>
            <li>Route optimization suggestions</li>
            <li>Skill-gap alerts</li>
          </ul>
        </div>
        
        <div class="stat-row">
          <div class="stat">
            <div class="stat-value">25%</div>
            <div class="stat-label">Travel Reduction</div>
          </div>
          <div class="stat">
            <div class="stat-value">2h 45m</div>
            <div class="stat-label">Daily Savings</div>
          </div>
        </div>
      </div>
      
      <!-- Glosa Defender -->
      <div class="agent-card glosa">
        <h4>‚öñÔ∏è Glosa Defender AI <span class="model">Claude Opus 4.5</span></h4>
        <p class="description">Advanced legal AI that generates bulletproof justifications to recover rejected healthcare claims.</p>
        
        <div class="io-section">
          <strong>üì• Inputs:</strong>
          <ul>
            <li>EPS rejection codes & reasons</li>
            <li>Complete patient history</li>
            <li>Clinical notes & vitals</li>
            <li>Resolution 3100 legal framework</li>
            <li>Previous successful defenses</li>
          </ul>
        </div>
        
        <div class="io-section">
          <strong>üì§ Outputs:</strong>
          <ul>
            <li>Legal justification document</li>
            <li>Evidence citations (PDF)</li>
            <li>Appeal strategy recommendations</li>
          </ul>
        </div>
        
        <div class="stat-row">
          <div class="stat">
            <div class="stat-value">92%</div>
            <div class="stat-label">Success Rate</div>
          </div>
          <div class="stat">
            <div class="stat-value">$5.1M</div>
            <div class="stat-label">Monthly Recovery</div>
          </div>
        </div>
      </div>
      
      <!-- RIPS Validator -->
      <div class="agent-card rips">
        <h4>üìù RIPS Validator AI <span class="model">Claude 3.7 Sonnet</span></h4>
        <p class="description">Pre-submission validation ensuring 100% compliance with Colombian healthcare billing regulations.</p>
        
        <div class="io-section">
          <strong>üì• Inputs:</strong>
          <ul>
            <li>Visit documentation</li>
            <li>Diagnosis codes (CIE-10)</li>
            <li>Procedure codes (CUPS)</li>
            <li>Colombian billing regulations</li>
            <li>Historical rejection patterns</li>
          </ul>
        </div>
        
        <div class="io-section">
          <strong>üì§ Outputs:</strong>
          <ul>
            <li>Validated RIPS XML files</li>
            <li>Error list with corrections</li>
            <li>Compliance confidence score</li>
          </ul>
        </div>
        
        <div class="stat-row">
          <div class="stat">
            <div class="stat-value">98%</div>
            <div class="stat-label">Pre-validation Accuracy</div>
          </div>
          <div class="stat">
            <div class="stat-value">&lt;2%</div>
            <div class="stat-label">Rejection Rate</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Roster Architect Detailed Flow -->
    <h2>üóìÔ∏è Roster Architect AI - Detailed Flow</h2>
    
    <div class="diagram">
      <pre class="mermaid">
sequenceDiagram
    participant Admin as üë®‚Äçüíº Admin
    participant API as GraphQL API
    participant Lambda as Lambda Function
    participant DDB as DynamoDB
    participant Bedrock as üß† Bedrock<br/>Claude 3.7 Sonnet
    participant Nurse as üë©‚Äç‚öïÔ∏è Nurse App
    
    Admin->>API: Request roster optimization
    API->>Lambda: invokeRosterArchitect()
    
    Lambda->>DDB: Fetch unassigned shifts
    DDB-->>Lambda: shifts[]
    
    Lambda->>DDB: Fetch available nurses
    DDB-->>Lambda: nurses[] with skills
    
    Lambda->>DDB: Fetch patient locations
    DDB-->>Lambda: patients[] with GPS
    
    Lambda->>Lambda: Build context object
    Note over Lambda: {<br/>  shifts: [...],<br/>  nurses: [...],<br/>  constraints: {...},<br/>  optimization_goals: [...]<br/>}
    
    Lambda->>Bedrock: POST /invoke<br/>with structured prompt
    
    Note over Bedrock: Analyzes:<br/>‚Ä¢ Travel distances<br/>‚Ä¢ Skill matching<br/>‚Ä¢ Workload balance<br/>‚Ä¢ Continuity of care
    
    Bedrock-->>Lambda: Optimal assignments JSON
    
    Lambda->>Lambda: Validate assignments
    Lambda->>DDB: Update shifts with nurseId
    
    Lambda-->>API: Success + metrics
    API-->>Admin: üìä Optimization complete
    
    Note over Admin: Reviews:<br/>‚Ä¢ 25% travel reduction<br/>‚Ä¢ 100% skill match<br/>‚Ä¢ Fair distribution
    
    Admin->>API: Approve roster
    API->>Lambda: publishRoster()
    Lambda-->>Nurse: üì± Push notification<br/>"New shifts assigned"
      </pre>
    </div>

    <div class="info-box">
      <h3>üí° Roster Architect Prompt Engineering</h3>
      <p><strong>System Prompt:</strong></p>
      <code style="display: block; white-space: pre-wrap; padding: 15px; margin-top: 10px;">
You are a healthcare scheduling optimizer for Colombian home care (IPS domiciliaria).

OPTIMIZATION GOALS (in priority order):
1. Match nurse certifications to patient requirements
2. Minimize total daily travel distance
3. Ensure continuity of care (same nurse when possible)
4. Balance workload across nurses fairly
5. Respect nurse availability windows

CONSTRAINTS:
- Max 8 hours per nurse per day
- 30-minute buffer between shifts
- Priority patients must be seen by senior nurses
- Rural areas require vehicle access

OUTPUT: JSON array of assignments with confidence scores.
      </code>
    </div>

    <!-- Glosa Defender Detailed Flow -->
    <h2>‚öñÔ∏è Glosa Defender AI - Detailed Flow</h2>
    
    <div class="diagram">
      <pre class="mermaid">
flowchart TD
    subgraph "1. Rejection Detection"
        EPS[üè• EPS sends rejection<br/>GLOSA notification]
        Parse[Parse rejection code<br/>& reason text]
        EPS --> Parse
    end
    
    subgraph "2. Evidence Gathering"
        Patient[(Patient History)]
        Visits[(Visit Documentation)]
        Clinical[Clinical Notes<br/>& Vitals]
        Photos[Wound Photos<br/>& Assessments]
        
        Parse --> Patient
        Parse --> Visits
        Parse --> Clinical
        Parse --> Photos
    end
    
    subgraph "3. Legal Framework"
        Res3100[üìú Resolution 3100<br/>Home care regulations]
        SOAT[üíä SOAT/POS<br/>Coverage rules]
        Precedents[‚öñÔ∏è Successful<br/>prior defenses]
    end
    
    subgraph "4. AI Analysis"
        Context[Build comprehensive<br/>context document]
        
        Patient --> Context
        Visits --> Context
        Clinical --> Context
        Photos --> Context
        Res3100 --> Context
        SOAT --> Context
        Precedents --> Context
        
        Bedrock[üß† Claude Opus 4.5<br/>Deep legal reasoning]
        Context --> Bedrock
    end
    
    subgraph "5. Output Generation"
        Justification[üìÑ Legal Justification<br/>Document]
        Citations[üìö Regulation<br/>Citations]
        Evidence[üîó Evidence<br/>References]
        PDF[üìë Combined PDF<br/>for EPS submission]
        
        Bedrock --> Justification
        Bedrock --> Citations
        Bedrock --> Evidence
        
        Justification --> PDF
        Citations --> PDF
        Evidence --> PDF
    end
    
    subgraph "6. Submission"
        Review[üë®‚Äçüíº Admin Review]
        Submit[üì§ Submit to EPS]
        Track[üìä Track Response]
        
        PDF --> Review
        Review --> Submit
        Submit --> Track
    end
    
    style EPS fill:#f87171,stroke:#dc2626
    style Bedrock fill:#f472b6,stroke:#be185d
    style PDF fill:#34d399,stroke:#059669
    style Res3100 fill:#f59e0b,stroke:#d97706
      </pre>
    </div>

    <div class="compliance-box">
      <h4>üá®üá¥ Colombian Healthcare Compliance Integration</h4>
      <div class="regulation-grid">
        <div class="regulation">
          <strong>Resolution 3100 of 2019</strong>
          <p>Defines quality standards for home healthcare services (IPS domiciliaria). AI cites specific articles when defending care necessity.</p>
        </div>
        <div class="regulation">
          <strong>RIPS Regulations</strong>
          <p>Registro Individual de Prestaci√≥n de Servicios - mandatory billing format. AI validates XML structure and code compliance.</p>
        </div>
        <div class="regulation">
          <strong>Plan de Beneficios en Salud (PBS)</strong>
          <p>Defines covered procedures. AI argues medical necessity when EPS claims non-coverage.</p>
        </div>
        <div class="regulation">
          <strong>Ley 1751 of 2015</strong>
          <p>Fundamental right to health. AI invokes when coverage is wrongfully denied.</p>
        </div>
      </div>
    </div>

    <!-- RIPS Validator Detailed Flow -->
    <h2>üìù RIPS Validator AI - Detailed Flow</h2>
    
    <div class="diagram">
      <pre class="mermaid">
sequenceDiagram
    participant Visit as üìã Visit Submission
    participant Lambda as Lambda Function
    participant AI as üß† Bedrock<br/>Claude 3.7 Sonnet
    participant Rules as üìú RIPS Rules<br/>Engine
    participant Output as üì§ Output
    
    Visit->>Lambda: Visit approved for billing
    
    Lambda->>Lambda: Extract billing data
    Note over Lambda: ‚Ä¢ CIE-10 diagnosis codes<br/>‚Ä¢ CUPS procedure codes<br/>‚Ä¢ Service dates/times<br/>‚Ä¢ Patient demographics<br/>‚Ä¢ Provider info
    
    Lambda->>Rules: Validate against schema
    Rules-->>Lambda: Schema validation result
    
    Lambda->>AI: Validate semantic consistency
    
    Note over AI: Checks:<br/>‚Ä¢ Diagnosis supports procedures<br/>‚Ä¢ Dates are logical<br/>‚Ä¢ Codes match services<br/>‚Ä¢ No duplicate billing<br/>‚Ä¢ Gender/age appropriateness
    
    AI-->>Lambda: Validation result + issues[]
    
    alt All Valid
        Lambda->>Output: ‚úÖ Generate RIPS XML
        Output-->>Visit: Ready for submission
    else Issues Found
        Lambda->>Output: ‚ö†Ô∏è Error report
        Note over Output: ‚Ä¢ Issue description<br/>‚Ä¢ Suggested correction<br/>‚Ä¢ Regulation reference<br/>‚Ä¢ Confidence score
        Output-->>Visit: Return for correction
    end
    
    Lambda->>Lambda: Log validation metrics
    Note over Lambda: ‚Ä¢ Pass rate: 98%<br/>‚Ä¢ Common errors tracked<br/>‚Ä¢ ML feedback loop
      </pre>
    </div>

    <div class="diagram">
      <pre class="mermaid">
pie showData
    title RIPS Validation Error Types
    "Code Mismatch" : 35
    "Missing Fields" : 25
    "Date Inconsistency" : 20
    "Diagnosis/Procedure Conflict" : 15
    "Duplicate Entry" : 5
      </pre>
    </div>

    <!-- System Integration -->
    <h2>üîó System Integration Architecture</h2>
    
    <div class="diagram">
      <pre class="mermaid">
graph TB
    subgraph "Frontend Applications"
        NurseApp[üë©‚Äç‚öïÔ∏è Nurse Mobile<br/>PWA]
        AdminApp[üë®‚Äçüíº Admin Portal]
        FamilyApp[üë®‚Äçüë©‚Äçüëß Family Portal]
    end
    
    subgraph "API Layer"
        AppSync[AWS AppSync<br/>GraphQL API]
        REST[API Gateway<br/>REST Endpoints]
    end
    
    subgraph "Business Logic"
        VisitLambda[Visit Processing<br/>Lambda]
        RosterLambda[Roster Orchestrator<br/>Lambda]
        BillingLambda[Billing Engine<br/>Lambda]
    end
    
    subgraph "AI Orchestration Layer"
        AIRouter[AI Request Router]
        
        subgraph "Amazon Bedrock"
            Sonnet1[Claude 3.7 Sonnet<br/>Roster Architect]
            Opus[Claude Opus 4.5<br/>Glosa Defender]
            Sonnet2[Claude 3.7 Sonnet<br/>RIPS Validator]
        end
        
        ResponseHandler[Response Handler<br/>& Validation]
    end
    
    subgraph "Data Layer"
        DynamoDB[(DynamoDB<br/>Operational Data)]
        S3[(S3<br/>Documents & PDFs)]
        OpenSearch[(OpenSearch<br/>Analytics)]
    end
    
    subgraph "External Systems"
        EPS[üè• EPS Portals]
        MinSalud[üèõÔ∏è MinSalud<br/>RIPS Submission]
    end
    
    NurseApp --> AppSync
    AdminApp --> AppSync
    AdminApp --> REST
    FamilyApp --> AppSync
    
    AppSync --> VisitLambda
    AppSync --> RosterLambda
    REST --> BillingLambda
    
    VisitLambda --> AIRouter
    RosterLambda --> AIRouter
    BillingLambda --> AIRouter
    
    AIRouter --> Sonnet1
    AIRouter --> Opus
    AIRouter --> Sonnet2
    
    Sonnet1 --> ResponseHandler
    Opus --> ResponseHandler
    Sonnet2 --> ResponseHandler
    
    ResponseHandler --> VisitLambda
    ResponseHandler --> RosterLambda
    ResponseHandler --> BillingLambda
    
    VisitLambda --> DynamoDB
    BillingLambda --> S3
    ResponseHandler --> OpenSearch
    
    BillingLambda --> MinSalud
    BillingLambda --> EPS
    
    style Sonnet1 fill:#34d399,stroke:#059669
    style Opus fill:#f472b6,stroke:#be185d
    style Sonnet2 fill:#60a5fa,stroke:#3b82f6
    style AIRouter fill:#f59e0b,stroke:#d97706
      </pre>
    </div>

    <!-- Cost/Benefit Analysis -->
    <h2>üí∞ Cost/Benefit Analysis</h2>
    
    <table class="cost-table">
      <thead>
        <tr>
          <th>Agent</th>
          <th>Model</th>
          <th>Est. Monthly Cost</th>
          <th>Monthly Benefit</th>
          <th>ROI</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>üóìÔ∏è Roster Architect</td>
          <td><code>Claude 3.7 Sonnet</code></td>
          <td>~$150</td>
          <td class="cost-positive">$12,000 (fuel + time)</td>
          <td class="cost-positive">8,000%</td>
        </tr>
        <tr>
          <td>‚öñÔ∏è Glosa Defender</td>
          <td><code>Claude Opus 4.5</code></td>
          <td>~$800</td>
          <td class="cost-positive">$5,100,000</td>
          <td class="cost-positive">637,400%</td>
        </tr>
        <tr>
          <td>üìù RIPS Validator</td>
          <td><code>Claude 3.7 Sonnet</code></td>
          <td>~$200</td>
          <td class="cost-positive">$45,000 (prevented rejections)</td>
          <td class="cost-positive">22,400%</td>
        </tr>
        <tr style="background: #1e293b;">
          <td><strong>TOTAL</strong></td>
          <td>-</td>
          <td><strong>~$1,150</strong></td>
          <td class="cost-positive"><strong>$5,157,000</strong></td>
          <td class="cost-positive"><strong>448,348%</strong></td>
        </tr>
      </tbody>
    </table>

    <div class="info-box">
      <h3>üìä Bedrock Pricing Reference</h3>
      <p><strong>Claude 3.7 Sonnet:</strong> $3.00/M input tokens, $15.00/M output tokens</p>
      <p><strong>Claude Opus 4.5:</strong> $15.00/M input tokens, $75.00/M output tokens</p>
      <p><em>Note: Opus used only for complex legal reasoning (Glosa Defender) where highest accuracy is critical.</em></p>
    </div>

    <!-- Data Flow Integration -->
    <h2>üîÑ Complete Data Flow</h2>
    
    <div class="diagram">
      <pre class="mermaid">
journey
    title Patient Visit Lifecycle with AI Enhancement
    section Scheduling
      Admin creates shift: 3: Admin
      Roster AI optimizes: 5: AI
      Nurse receives assignment: 5: Nurse
    section Documentation
      Nurse documents visit: 4: Nurse
      RIPS AI validates: 5: AI
      Admin approves: 4: Admin
    section Billing
      RIPS submitted to EPS: 4: System
      EPS accepts (98%): 5: EPS
      EPS rejects (2%): 2: EPS
    section Recovery
      Glosa AI generates defense: 5: AI
      Admin reviews & submits: 4: Admin
      Revenue recovered (92%): 5: System
      </pre>
    </div>

    <!-- Technical Implementation -->
    <h2>üõ†Ô∏è Technical Implementation</h2>
    
    <div class="agent-grid">
      <div class="agent-card" style="border-top: 4px solid #818cf8;">
        <h4>Lambda Configuration</h4>
        <code style="display: block; white-space: pre-wrap; padding: 15px;">
// roster-architect-lambda
Runtime: Node.js 20.x
Memory: 1024 MB
Timeout: 60 seconds
Environment:
  BEDROCK_REGION: us-east-1
  MODEL_ID: anthropic.claude-3-7-sonnet
  MAX_TOKENS: 4096
        </code>
      </div>
      
      <div class="agent-card" style="border-top: 4px solid #818cf8;">
        <h4>IAM Permissions</h4>
        <code style="display: block; white-space: pre-wrap; padding: 15px;">
{
  "Effect": "Allow",
  "Action": [
    "bedrock:InvokeModel",
    "bedrock:InvokeModelWithResponseStream"
  ],
  "Resource": [
    "arn:aws:bedrock:*::foundation-model/anthropic.claude-3-7-sonnet*",
    "arn:aws:bedrock:*::foundation-model/anthropic.claude-opus-4-5*"
  ]
}
        </code>
      </div>
      
      <div class="agent-card" style="border-top: 4px solid #818cf8;">
        <h4>Error Handling</h4>
        <code style="display: block; white-space: pre-wrap; padding: 15px;">
Retry Strategy:
  - Throttling: Exponential backoff
  - Model errors: Fallback to Sonnet
  - Timeout: Queue for async processing

Monitoring:
  - CloudWatch metrics per agent
  - X-Ray tracing enabled
  - Cost alerts at $100/day
        </code>
      </div>
    </div>

    <!-- Summary -->
    <div class="info-box" style="background: linear-gradient(145deg, #1e293b 0%, #0f172a 100%); border-left-color: #34d399;">
      <h3>üéØ Key Takeaways</h3>
      <ul>
        <li><strong>Right Model for the Job:</strong> Sonnet for efficiency (roster, validation), Opus for complex reasoning (legal defense)</li>
        <li><strong>Colombian Compliance Built-In:</strong> Resolution 3100, RIPS, PBS deeply integrated into AI prompts</li>
        <li><strong>Massive ROI:</strong> $1,150/month investment yields $5.1M+ in recovered revenue</li>
        <li><strong>Human-in-the-Loop:</strong> AI assists, humans approve - ensuring accountability</li>
        <li><strong>Continuous Improvement:</strong> Feedback loops train AI on rejection patterns</li>
      </ul>
    </div>

    <p style="text-align: center; color: #64748b; margin-top: 50px;">
      IPS-ERP AI Agents Documentation ‚Ä¢ Version 1.0 ‚Ä¢ Last Updated: January 2026
    </p>

  </div>

  <script>
    mermaid.initialize({ 
      startOnLoad: true,
      theme: 'dark',
      themeVariables: {
        primaryColor: '#818cf8',
        primaryTextColor: '#0f172a',
        primaryBorderColor: '#4f46e5',
        lineColor: '#94a3b8',
        secondaryColor: '#a78bfa',
        tertiaryColor: '#34d399',
        background: '#1e293b',
        mainBkg: '#1e293b',
        secondBkg: '#334155',
        tertiaryBkg: '#0f172a'
      },
      flowchart: {
        curve: 'basis',
        padding: 20
      },
      sequence: {
        actorMargin: 50,
        boxMargin: 10,
        boxTextMargin: 5
      }
    });
  </script>
</body>
</html>
